import{c as h,p as w}from"./chunk-NQJKZR6M.js";import{A as u,E as c,G as f,H as l,g as d,ib as m,k as p,nb as g}from"./chunk-WGR6NMIH.js";var j=new f("JWT_OPTIONS"),k=(()=>{class o{constructor(t=null){this.tokenGetter=t&&t.tokenGetter||function(){}}urlBase64Decode(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:{e+="==";break}case 3:{e+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(e)}b64decode(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let n=0,s,a,T=0;a=t.charAt(T++);~a&&(s=n%4?s*64+a:a,n++%4)?r+=String.fromCharCode(255&s>>(-2*n&6)):0)a=e.indexOf(a);return r}b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this.b64decode(t),e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(t=this.tokenGetter()){return t instanceof Promise?t.then(e=>this._decodeToken(e)):this._decodeToken(t)}_decodeToken(t){if(!t||t==="")return null;let e=t.split(".");if(e.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(e[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(t=this.tokenGetter()){return t instanceof Promise?t.then(e=>this._getTokenExpirationDate(e)):this._getTokenExpirationDate(t)}_getTokenExpirationDate(t){let e;if(e=this.decodeToken(t),!e||!e.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(e.exp),r}isTokenExpired(t=this.tokenGetter(),e){return t instanceof Promise?t.then(r=>this._isTokenExpired(r,e)):this._isTokenExpired(t,e)}_isTokenExpired(t,e){if(!t||t==="")return!0;let r=this.getTokenExpirationDate(t);return e=e||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+e*1e3)}getAuthScheme(t,e){return typeof t=="function"?t(e):t}}return o.\u0275fac=function(t){return new(t||o)(l(j))},o.\u0275prov=c({token:o,factory:o.\u0275fac}),o})();var H=(()=>{let i=class i{constructor(e,r,n){this.http=e,this.router=r,this.fb=n,this.jwtToken=new k,this.authSubject=new d(null),this.user$=this.authSubject.asObservable(),this.isLogged=!1,this.logged$=this.user$.pipe(p(s=>!!s),u(s=>this.isLogged=s)),this.loginUrl="http://localhost:3000/login",this.registerUrl="http://localhost:3000/register",this.restoreUser()}getUserLogin(){return this.userForm=this.fb.group({email:this.fb.control(null,[h.required,h.email]),password:this.fb.control(null,h.required)}),this.userForm}register(e){return this.http.post(this.registerUrl,e)}login(e){return this.http.post(this.loginUrl,e).pipe(u(r=>{this.authSubject.next(r.user),localStorage.setItem("token",JSON.stringify(r)),this.autoLogout()}))}logout(){this.authSubject.next(null),localStorage.removeItem("token")}getAccessToken(){let e=localStorage.getItem("token");return e?JSON.parse(e):null}getAllUsers(){return this.http.get(this.loginUrl)}createNew(e,r){e.email=r.value.email,e.password=r.value.password}restoreUser(){let e=this.getAccessToken();e&&(this.jwtToken.isTokenExpired(e.accessToken)||(this.authSubject.next(e.user),this.autoLogout()))}autoLogout(){let e=this.getAccessToken();if(!e)return;let n=this.jwtToken.getTokenExpirationDate(e.accessToken).getTime()-new Date().getTime();setTimeout(this.logout,n)}};i.\u0275fac=function(r){return new(r||i)(l(m),l(g),l(w))},i.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();export{H as a};
